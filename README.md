# CanvasCraft

CanvasCraft 是一个功能强大的在线协作绘图应用，基于 Next.js 和 React 构建，提供丰富的绘图工具和实时协作功能，让用户能够轻松创建和分享精美图形作品。

## 项目简介

CanvasCraft 旨在提供一个直观、高效的绘图环境，支持多种绘图工具和画布操作，同时具备实时协作能力，使团队成员可以共同编辑同一个画布。项目采用现代前端技术栈，确保流畅的用户体验和良好的性能。

## 环境要求

- Node.js 16.x 或更高版本
- npm、yarn 或 pnpm 包管理器
- 现代浏览器（推荐使用 Chrome、Firefox、Safari 或 Edge 的最新版本）

## 安装与启动

### 1. 安装依赖

```bash
# 使用 npm
npm install

# 或使用 yarn
yarn install

# 或使用 pnpm
pnpm install
```

### 2. 启动开发服务器

```bash
# 使用 npm
npm run dev

# 或使用 yarn
yarn dev

# 或使用 pnpm
pnpm dev
```

然后在浏览器中访问 [http://localhost:3000](http://localhost:3000)

### 3. 构建生产版本

```bash
# 使用 npm
npm run build
npm run start

# 或使用 yarn
yarn build
yarn start

# 或使用 pnpm
pnpm build
pnpm start
```

## 主要功能

### 绘图工具
- 选择工具（V）：选择、移动、调整图形大小（P0）
- 拖拽工具（H）：平移画布（P0）
- 画笔（P）：自由绘制曲线（额外功能）
- 矩形（R）：绘制矩形（P0）
- 圆形（C）：绘制圆形（P0）
- 线条（L）：绘制直线（P0）
- 箭头（A）：绘制带箭头的线段（额外功能）
- 文本（T）：添加和编辑文本（P0）
- 图像（I）：导入和编辑图像（P0）

### 画布操作
- 缩放控制：放大、缩小、重置缩放（P0 + 额外功能）
- 无限画布滚动条：无边界的画布导航（挑战 ⭐️⭐️）
- 适应屏幕：自动调整缩放以适应画布内容（额外功能）
- 网格显示：开启/关闭网格辅助（额外功能）
- 对齐吸附：启用/禁用对象对齐吸附功能（额外功能）
- 辅助线：开启/关闭辅助线功能，辅助用户对齐元素，辅助线功能与吸附功能绑定（挑战 ⭐️⭐️⭐️）
- 图形属性管理：编辑选中图形的详细属性，包括编辑背景色、边框颜色、边框宽度等（P0）
- 文本属性管理：编辑选中文本的详细属性，包括字体、字号、颜色、背景色、字体样式（BIUS）等（P0）
- 图像属性管理：编辑选中图像的详细属性，包括宽度、高度、旋转角度、滤镜等（P0）
- 选区功能：单击选择单个元素，Ctrl + 单击选择多个元素，Ctrl + A 选择所有元素（P0 + 额外功能）
- 复制/粘贴功能：复制选中元素，粘贴到画布上（P0）

### 样式设置
- 颜色选择器：自定义线条和填充颜色（P0）
- 线条宽度调整：设置绘图线条粗细（P0）
- 透明度控制：调整对象透明度（额外功能）
- 旋转功能：旋转选定对象（挑战⭐️）

### 元素编辑
- 双击编辑：支持双击文本进入编辑，可以输入/删除文本内容（P0）
- 元素删除：支持对选中元素（单个或多个）删除（P0）
- 元素拖拽：支持对选中元素（单个或多个）拖拽（P0）
- 元素缩放：支持对选中元素（单个或多个）缩放（P0）
- 元素旋转：支持对选中元素（单个或多个）旋转（挑战 ⭐️）
- 元素组合：支持对多个元素进行组合操作，组合可以嵌套（挑战 ⭐️⭐️）

### 性能优化
- 批量渲染：优化大规模画布的渲染性能，实现画布存在 100 个元素，打开页面到渲染完成 < 3s（P0）
- 内存管理：有效管理画布上的对象内存，实现同时操作 100 个元素，FPS 50+（挑战 ⭐️⭐️）

### 文件操作
- 保存到本地存储：保存当前画布内容（P0）
- 从本地加载：恢复之前保存的画布（P0）
- 清除画布：一键清空所有内容（额外功能）

### 协作功能
- 实时多人协作编辑（挑战 ⭐️⭐️⭐️⭐️⭐️）
- 状态同步与自动保存（挑战 ⭐️⭐️⭐️⭐️⭐️）
- 断线重连机制（额外功能）

### 辅助功能
- 撤销/重做操作（挑战 ⭐️⭐️⭐️）
- 暗黑模式支持（额外功能）
- 键盘快捷键支持（额外功能）
- 属性面板：编辑选中对象的详细属性（P0）

## 目录结构

```
CanvasCraft/
├── app/                    # Next.js 应用主目录
│   ├── globals.css         # 全局样式
│   ├── layout.tsx          # 应用布局
│   └── page.tsx            # 主页
├── components/             # React 组件
│   ├── drawing-canvas.tsx  # 绘图画布组件
│   ├── drawing-toolbar.tsx # 绘图工具栏
│   ├── color-picker.tsx    # 颜色选择器
│   ├── stroke-width-picker.tsx # 线条宽度选择器
│   ├── properties-panel.tsx # 属性面板
│   ├── canvas-operations.tsx # 画布操作组件
│   ├── keyboard-shortcuts.tsx # 键盘快捷键处理
│   ├── theme-toggle.tsx    # 主题切换
│   └── ui/                 # UI 基础组件
├── lib/                    # 工具库和服务
│   ├── canvas-store.ts     # 画布状态管理
│   ├── collaboration-service.ts # 协作服务
│   └── server.js           # 协作服务器
├── types/                  # TypeScript 类型定义
│   └── canvas.ts           # 画布相关类型
├── public/                 # 静态资源
├── styles/                 # 样式文件
└── package.json            # 项目配置和依赖
```

## 技术栈

- **前端框架**：React 18, Next.js 15
- **类型系统**：TypeScript
- **状态管理**：Zustand
- **UI 组件库**：Radix UI
- **样式方案**：Tailwind CSS
- **协同编辑**：ShareDB, WebSocket
- **构建工具**：Next.js 内置构建工具

## 协作功能说明

CanvasCraft 的协作功能基于 ShareDB 和 WebSocket 实现，允许多个用户同时编辑同一个画布。启动协作功能需要运行后端 WebSocket 服务器：

```bash
# 启动协作服务器
node lib/server.js
```

然后在应用中，协作功能将自动连接到本地服务器。

## 键盘快捷键

- **V**: 选择工具
- **H**: 拖拽工具
- **P**: 画笔工具
- **R**: 矩形工具
- **C**: 圆形工具
- **L**: 线条工具
- **A**: 箭头工具
- **T**: 文本工具
- **I**: 图像工具
- **Ctrl + Z**: 撤销
- **Ctrl + Y**: 重做
- **Delete**: 删除选中对象
- **Ctrl + S**: 保存
- **+/-**: 放大/缩小
- **Space + 拖拽**: 平移画布
- **Ctrl + A**: 全选
- **Ctrl + 0**: 重置缩放
- **Ctrl + 1**: 适应屏幕
- **Ctrl + s**: 吸附选择
- **Ctrl + Shift + Del**: 清空画布
- **Escape**: 退出选中元素
- **Shift + Click**: 多选